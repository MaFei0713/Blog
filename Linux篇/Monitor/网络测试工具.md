## iperf && iperf3

iperf / iperf3 是一款基于命令行模式的网络性能测试工具，提供跨widnows、linux、mac的全平台支持，除了能够测试TCP以及UDP协议的最大带宽外，还能报告网络延迟，抖动以及丢包率。使用方便，容易伤愁，iperf全程使用内存作为发送/接收缓冲区，不受磁盘性能的影响，对于机器配置要求低。由于是命令行工具，不支持输出测试图形。

### Iperf常用参数（测试够用）

- -s,–server：iperf服务器模式，默认启动的监听端口为5201，eg：iperf -s

- -c,–client host：iperf客户端模式，host是server端地址，eg：iperf -c 222.35.11.23

- -i，–interval：指定每次报告之间的时间间隔，单位为秒，eg：iperf3 -c 192.168.12.168 -i 2

- -p，–port：指定服务器端监听的端口或客户端所连接的端口，默认是5001端口。

- -u，–udp：表示采用UDP协议发送报文，不带该参数表示采用TCP协议。

- -l，–len：设置读写缓冲区的长度，单位为 Byte。TCP方式默认为8KB，UDP方式默认为1470字节。通常测试 PPS 的时候该值为16，测试BPS时该值为1400。

- -b，–bandwidth [K|M|G]：指定UDP模式使用的带宽，单位bits/sec，默认值是1 Mbit/sec。

- -t，–time：指定数据传输的总时间，即在指定的时间内，重复发送指定长度的数据包。默认10秒。

- -A：CPU亲和性，可以将具体的iperf3进程绑定对应编号的逻辑CPU，避免iperf进程在不同的CPU间调度。

### 通用参数（Server端和Client端共用）

- -f，–farmat [k|m|g|K|M|G]：指定带宽输出单位，“[k|m|g|K|M|G]”分别表示以Kbits, Mbits, Gbits, KBytes, MBytes,GBytes显示输出结果，默认Mbits，eg：iperf3 -c 192.168.12.168 -f M

- -p，–port：指定服务器端监听的端口或客户端所连接的端口，默认是5001端口。

- -i，–interval：指定每次报告之间的时间间隔，单位为秒，eg：iperf3 -c 192.168.12.168 -i 2

- -F：指定文件作为数据流进行带宽测试。例如：iperf3 -c 192.168.12.168 -F web-ixdba.tar.gz

### Server端专用参数

- -s,–server：iperf服务器模式，默认启动的监听端口为5201，eg：iperf -s

- -c,–client host：如果iperf运行在服务器模式，并且用-c参数指定一个主机，那么iperf将只接受指定主机的连接。此参数不能工作于UDP模式。

- -D：Unix平台下将Iperf作为后台守护进程运行。在Win32平台下，Iperf将作为服务运行。

- -R：卸载Iperf服务(仅用于Windows)。

- -o：重定向输出到指定文件(仅用于Windows)。

- -P,–parallel：服务器关闭之前保持的连接数。默认是0，这意味着永远接受连接。

### Client端专用参数

- -c,–client host：iperf客户端模式，host是server端地址，eg：iperf -c 222.35.11.23

- -u，–udp：表示采用UDP协议发送报文，不带该参数表示采用TCP协议。

- -b，–bandwidth [K|M|G]：指定UDP模式使用的带宽，单位bits/sec，默认值是1 Mbit/sec。

- -t，–time：指定数据传输的总时间，即在指定的时间内，重复发送指定长度的数据包。默认10秒。

- -l，–len：设置读写缓冲区的长度，单位为 Byte。TCP默认为8KB，UDP默认为1470字节。通常测试 PPS 的时候该值为16，测试BPS时该值为1400。

- -n，–num [K|M|G]：指定传输数据包的字节数，例如：iperf3 -c 192.168.12.168 –n 100M

- -P,–parallel：指定客户端与服务端之间使用的线程数。默认是1个线程。需要客户端与服务器端同时使用此参数。

- -w，–window：指定套接字缓冲区大小，在TCP方式下，此设置为TCP窗口的大小。在UDP方式下，此设置为接受UDP数据包的缓冲区大小，用来限制可以接收数据包的最大值

- -B，–bind：用来绑定一个主机地址或接口，这个参数仅用于具有多个网络接口的主机。在UDP模式下，此参数用于绑定和加入一个多播组。

- -M，–mss：设置TCP最大信息段的值

- -N，–nodelay：设置TCP无延时

- -V：绑定一个IPv6地址。

- -d，–dualtest：运行双测试模式。将使服务器端反向连接到客户端，使用-L参数中指定的端口（或默认使用客户端连接到服务器端的端口）。使用参数-r以运行交互模式。

- -L,–listenport：指定服务端反向连接到客户端时使用的端口。默认使用客户端连接至服务端的端口。

- -r，–tradeoff：往复测试模式。当客户端到服务器端的测试结束时，服务器端反向连接至客户端。当客户端连接终止时，反向连接随即开始。如果需要同时进行双向测试，请尝试-d参数。